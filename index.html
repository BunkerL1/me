<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obter IP do Visitante</title>
    <style>
        body {
            background-color: black;
            color: limegreen;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        #terminal {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #ipAddress {
            margin-top: 20px;
        }

        #processingMessage {
            text-align: center;
            margin-bottom: 20px;
        }

        #typingAnimation {
            overflow: hidden;
            white-space: nowrap;
            margin-top: 20px;
            border-right: 2px solid limegreen;
            font-size: 16px;
            animation: typing 1s steps(40, end);
            display: none;
        }

        #loadingBarContainer {
            width: 100%;
            display: none;
            margin-top: 20px;
        }

        #loadingBar {
            width: 0;
            height: 20px;
            background-color: limegreen;
            transition: width 10s linear;
        }

        #completionMessage {
            margin-top: 20px;
            display: none;
        }

        @keyframes typing {
            from {
                width: 0;
            }
            to {
                width: 30ch;
            }
        }
    </style>
</head>
<body>

    <div id="terminal">
        <h1 id="processingMessage">Processando e enviando o conteúdo...</h1>

        <p id="ipAddress">Aguarde...</p>

        <div id="typingAnimation">
            Seu endereço IP está sendo enviado para nosso banco de dados <br>
            com o propósito de contabilizar dados geográficos. <br>
            Essa ação é parte de testes para um futuro trabalho acadêmico e <br>
            não será utilizado para propósitos maliciosos.<br>
            Atenciosamente,<br>
            [Lean]
            <br>
        </div>

        <div id="loadingBarContainer">
            <div id="loadingBar"></div>
        </div>

        <p id="completionMessage">Envio completo!</p>
    </div>

    <script>
        function getIpAddress() {
            fetch('https://api64.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    const ipAddress = data.ip;
                    document.getElementById('ipAddress').innerText = `Seu endereço IP é: ${ipAddress}`;

                    document.getElementById('typingAnimation').style.display = 'block';

                    setTimeout(function () {
                        document.getElementById('loadingBarContainer').style.display = 'block';

                        let width = 0;
                        const loadingBar = document.getElementById('loadingBar');

                        function increaseWidth() {
                            width++;
                            loadingBar.style.width = width + '%';

                            document.getElementById('loadingBar').innerText = width + '%';

                            if (width < 100) {
                                requestAnimationFrame(increaseWidth);
                            } else {
                                document.getElementById('loadingBarContainer').style.display = 'none';
                                document.getElementById('completionMessage').style.display = 'block';

                                // Enviar o endereço IP para o arquivo PHP no servidor
                                fetch('https://leanbnk.000webhostapp.com/save_ip.php', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/x-www-form-urlencoded',
                                    },
                                    body: 'ip=' + encodeURIComponent(ipAddress),
                                })
                                    .then(response => response.text())
                                    .then(message => console.log(message))
                                    .catch(error => console.error('Erro ao enviar o IP:', error));
                            }
                        }

                        increaseWidth();
                    }, 3000);
                })
                .catch(error => {
                    console.error('Erro ao obter o endereço IP:', error);
                    document.getElementById('ipAddress').innerText = 'Erro ao obter o endereço IP';
                });
        }

        window.onload = function () {
            setTimeout(function () {
                document.getElementById('processingMessage').style.display = 'none';
                getIpAddress();
            }, 2000);
        };
    </script>

</body>
</html>
